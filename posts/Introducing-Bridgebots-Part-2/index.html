<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Introducing Bridgebots Part 2: Deal Records and PBNs" /><meta property="og:locale" content="en_US" /><meta name="description" content="Last week I introduced a new bridge programming library: Bridgebots. I covered how to create and interact with Cards, Suits, and Deals. Today we’ll look at how Bridgebots represents the auction, the play of the hand, the score, and other event metadata. Once we have all the building blocks for representing bridge matches, I’ll show you how Bridgebots can consume one of the most popular bridge data formats: PBN files." /><meta property="og:description" content="Last week I introduced a new bridge programming library: Bridgebots. I covered how to create and interact with Cards, Suits, and Deals. Today we’ll look at how Bridgebots represents the auction, the play of the hand, the score, and other event metadata. Once we have all the building blocks for representing bridge matches, I’ll show you how Bridgebots can consume one of the most popular bridge data formats: PBN files." /><link rel="canonical" href="https://forrestrice.com/posts/Introducing-Bridgebots-Part-2/" /><meta property="og:url" content="https://forrestrice.com/posts/Introducing-Bridgebots-Part-2/" /><meta property="og:site_name" content="Forrest Rice" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-18T12:45:09-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Introducing Bridgebots Part 2: Deal Records and PBNs" /><meta name="twitter:site" content="@Forrest_Rice" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Last week I introduced a new bridge programming library: Bridgebots. I covered how to create and interact with Cards, Suits, and Deals. Today we’ll look at how Bridgebots represents the auction, the play of the hand, the score, and other event metadata. Once we have all the building blocks for representing bridge matches, I’ll show you how Bridgebots can consume one of the most popular bridge data formats: PBN files.","url":"https://forrestrice.com/posts/Introducing-Bridgebots-Part-2/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://forrestrice.com/posts/Introducing-Bridgebots-Part-2/"},"headline":"Introducing Bridgebots Part 2: Deal Records and PBNs","dateModified":"2021-11-28T17:26:44-08:00","datePublished":"2021-09-18T12:45:09-07:00","@context":"https://schema.org"}</script><title>Introducing Bridgebots Part 2: Deal Records and PBNs | Forrest Rice</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Forrest Rice"><meta name="application-name" content="Forrest Rice"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/headshot.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Forrest Rice</a></div><div class="site-subtitle font-italic">Life and other games</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/forrestrice" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/Forrest_Rice" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['forrest.d.rice','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Introducing Bridgebots Part 2: Deal Records and PBNs</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Introducing Bridgebots Part 2: Deal Records and PBNs</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Forrest Rice </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Sep 18, 2021, 12:45 PM -0700" prep="on" > Sep 18, 2021 <i class="unloaded">2021-09-18T12:45:09-07:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Nov 28, 2021, 5:26 PM -0800" prefix="Updated " > Nov 28, 2021 <i class="unloaded">2021-11-28T17:26:44-08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1562 words">8 min</span></div></div><div class="post-content"><p>Last week I <a href="/posts/Introducting-Bridgebots-Part-1">introduced</a> a new bridge programming library: <a href="https://github.com/forrestrice/bridge-bots">Bridgebots</a>. I covered how to create and interact with Cards, Suits, and Deals. Today we’ll look at how Bridgebots represents the auction, the play of the hand, the score, and other event metadata. Once we have all the building blocks for representing bridge matches, I’ll show you how Bridgebots can consume one of the most popular bridge data formats: PBN files.</p><h3 id="setting-the-table">Setting the Table</h3><p>There are many pieces of data that could be tracked while playing bridge, but a few are non-negotiable. Those are:</p><ol><li>Players<li>Auction<li>Declarer<li>Contract<li>Card play<li>Number of tricks taken</ol><p>Depending on the use case for the data, other important fields might include:</p><ol><li>Alerts and explanations of bids<li>The scoring format<li>The event name and date<li>Player convention cards<li>Commentary from observers</ol><p>Bridgebots currently supports most of these fields using the <code class="language-plaintext highlighter-rouge">DealRecord</code>, <code class="language-plaintext highlighter-rouge">BoardRecord</code>, <code class="language-plaintext highlighter-rouge">Contract</code>, <code class="language-plaintext highlighter-rouge">Commentary</code>, <code class="language-plaintext highlighter-rouge">BidMetadata</code> classes.</p><p><code class="language-plaintext highlighter-rouge">BidMetadata</code> captures alerts and explanations and has a reference to which bid the metadata applies to.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">bridgebots</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BidMetadata</span><span class="p">,</span>
    <span class="n">BiddingSuit</span><span class="p">,</span>
    <span class="n">BoardRecord</span><span class="p">,</span>
    <span class="n">Card</span><span class="p">,</span>
    <span class="n">Commentary</span><span class="p">,</span>
    <span class="n">Contract</span><span class="p">,</span>
    <span class="n">DealRecord</span><span class="p">,</span>
    <span class="n">Direction</span><span class="p">,</span>
    <span class="n">from_pbn_deal</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">bidding_metadata</span> <span class="o">=</span> <span class="n">BidMetadata</span><span class="p">(</span>
    <span class="n">bid_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
    <span class="n">bid</span><span class="o">=</span><span class="s">"2NT"</span><span class="p">,</span> 
    <span class="n">alerted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
    <span class="n">explanation</span><span class="o">=</span><span class="s">"Unusual No Trump: 2 5card minors"</span>
<span class="p">)</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Commentary</code> is similar in that it can reference a specific bid or card played.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">comment</span> <span class="o">=</span> <span class="n">Commentary</span><span class="p">(</span><span class="n">bid_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">play_index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s">"Amazing!"</span><span class="p">),</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Contract</code> includes the suit, the level, and a count of the number of times the contract was doubled.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">BiddingSuit</span><span class="p">.</span><span class="n">DIAMONDS</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># 6DX
</span></pre></table></code></div></div><p>All of these are inputs into <code class="language-plaintext highlighter-rouge">BoardRecord</code> - the record of the play of a deal at a single table.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="n">play_record_strings</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">"H4"</span><span class="p">,</span> <span class="s">"H2"</span><span class="p">,</span> <span class="s">"HJ"</span><span class="p">,</span> <span class="s">"HA"</span><span class="p">,</span>
        <span class="s">"DA"</span><span class="p">,</span> <span class="s">"D4"</span><span class="p">,</span> <span class="s">"D3"</span><span class="p">,</span> <span class="s">"S3"</span><span class="p">,</span>
        <span class="s">"DJ"</span><span class="p">,</span> <span class="s">"D8"</span><span class="p">,</span> <span class="s">"D6"</span><span class="p">,</span> <span class="s">"S4"</span><span class="p">,</span>
        <span class="s">"DT"</span><span class="p">,</span> <span class="s">"D9"</span><span class="p">,</span> <span class="s">"D7"</span><span class="p">,</span> <span class="s">"S6"</span><span class="p">,</span>
        <span class="s">"D2"</span><span class="p">,</span> <span class="s">"C3"</span><span class="p">,</span> <span class="s">"DK"</span><span class="p">,</span> <span class="s">"SJ"</span><span class="p">,</span>
        <span class="s">"DQ"</span><span class="p">,</span> <span class="s">"C4"</span><span class="p">,</span> <span class="s">"D5"</span><span class="p">,</span> <span class="s">"S7"</span><span class="p">,</span>
        <span class="s">"S2"</span><span class="p">,</span> <span class="s">"H3"</span><span class="p">,</span> <span class="s">"SK"</span><span class="p">,</span> <span class="s">"SA"</span><span class="p">,</span>
        <span class="s">"HT"</span><span class="p">,</span> <span class="s">"HQ"</span><span class="p">,</span> <span class="s">"HK"</span><span class="p">,</span> <span class="s">"C2"</span><span class="p">,</span>
        <span class="s">"H5"</span><span class="p">,</span> <span class="s">"S5"</span><span class="p">,</span> <span class="s">"H9"</span><span class="p">,</span> <span class="s">"H8"</span><span class="p">,</span>
        <span class="s">"C5"</span><span class="p">,</span> <span class="s">"CT"</span><span class="p">,</span> <span class="s">"CA"</span><span class="p">,</span> <span class="s">"C6"</span><span class="p">,</span>
        <span class="s">"H7"</span><span class="p">,</span> <span class="s">"C7"</span><span class="p">,</span> <span class="s">"ST"</span><span class="p">,</span> <span class="s">"S8"</span><span class="p">,</span>
        <span class="s">"H6"</span><span class="p">,</span> <span class="s">"C9"</span><span class="p">,</span> <span class="s">"C8"</span><span class="p">,</span> <span class="s">"S9"</span><span class="p">,</span>
        <span class="s">"CQ"</span><span class="p">,</span> <span class="s">"CJ"</span><span class="p">,</span> <span class="s">"CK"</span><span class="p">,</span> <span class="s">"SQ"</span><span class="p">,</span>
        <span class="p">]</span>
<span class="n">board_record</span> <span class="o">=</span> <span class="n">BoardRecord</span><span class="p">(</span>
    <span class="n">bidding_record</span><span class="o">=</span><span class="p">[</span><span class="s">"PASS"</span><span class="p">,</span> <span class="s">"1H"</span><span class="p">,</span> <span class="s">"2NT"</span><span class="p">,</span> <span class="s">"PASS"</span><span class="p">,</span> <span class="s">"3NT"</span><span class="p">,</span> <span class="s">"PASS"</span><span class="p">,</span> <span class="s">"PASS"</span><span class="p">,</span> <span class="s">"PASS"</span><span class="p">],</span>
    <span class="n">raw_bidding_record</span><span class="o">=</span><span class="p">[</span><span class="s">"p"</span><span class="p">,</span> <span class="s">"1H"</span><span class="p">,</span> <span class="s">"2N"</span><span class="p">,</span> <span class="s">"p"</span><span class="p">,</span> <span class="s">"3N"</span><span class="p">,</span> <span class="s">"p"</span><span class="p">,</span> <span class="s">"p"</span><span class="p">,</span> <span class="s">"p"</span><span class="p">],</span>
    <span class="n">play_record</span><span class="o">=</span><span class="p">[</span><span class="n">Card</span><span class="p">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">play_record_strings</span><span class="p">],</span>
    <span class="n">declarer</span><span class="o">=</span><span class="n">Direction</span><span class="p">.</span><span class="n">NORTH</span><span class="p">,</span>
    <span class="n">declarer_vulnerable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">contract</span><span class="o">=</span><span class="n">Contract</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">BiddingSuit</span><span class="p">.</span><span class="n">NO_TRUMP</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">tricks</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="p">{</span>
        <span class="n">Direction</span><span class="p">.</span><span class="n">NORTH</span><span class="p">:</span> <span class="s">"smalark"</span><span class="p">,</span>
        <span class="n">Direction</span><span class="p">.</span><span class="n">SOUTH</span><span class="p">:</span> <span class="s">"PrinceBen"</span><span class="p">,</span>
        <span class="n">Direction</span><span class="p">.</span><span class="n">EAST</span><span class="p">:</span> <span class="s">"granola357"</span><span class="p">,</span>
        <span class="n">Direction</span><span class="p">.</span><span class="n">WEST</span><span class="p">:</span> <span class="s">"Forrest_"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">date</span><span class="o">=</span><span class="s">"2020-03-13"</span><span class="p">,</span>
    <span class="n">event</span><span class="o">=</span><span class="s">"QuickTricks Club Game"</span><span class="p">,</span>
    <span class="n">bidding_metadata</span><span class="o">=</span><span class="p">[</span>
        <span class="n">BidMetadata</span><span class="p">(</span><span class="n">bid_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bid</span><span class="o">=</span><span class="s">"2NT"</span><span class="p">,</span> <span class="n">alerted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">explanation</span><span class="o">=</span><span class="s">"Unusual No Trump: 2 5card minors"</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">commentary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
<span class="p">)</span>
</pre></table></code></div></div><p>Finally a <code class="language-plaintext highlighter-rouge">DealRecord</code> is simply a combination of a <code class="language-plaintext highlighter-rouge">Deal</code> and a list of <code class="language-plaintext highlighter-rouge">BoardRecords</code> corresponding to all the times the deal was played.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1"># Peeking ahead at how PBN data can be consumed
</span><span class="n">deal</span> <span class="o">=</span> <span class="n">deal_utils</span><span class="p">.</span><span class="n">from_pbn_deal</span><span class="p">(</span><span class="s">"N"</span><span class="p">,</span> <span class="s">"None"</span><span class="p">,</span> <span class="s">"W:98.KT5.J75.KJT84 K753.Q94.AT84.62 QJ6.AJ8762.62.73 AT42.3.KQ93.AQ95"</span><span class="p">)</span>
<span class="n">deal_record</span> <span class="o">=</span> <span class="n">DealRecord</span><span class="p">(</span><span class="n">deal</span><span class="p">,</span> <span class="p">[</span><span class="n">board_record</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">deal_record</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="go">DealRecord(deal=Deal(
	dealer=Direction.NORTH, ns_vulnerable=False, ew_vulnerable=False
	North: PlayerHand(SK S7 S5 S3 | HQ H9 H4 | DA DT D8 D4 | C6 C2)
	South: PlayerHand(SA ST S4 S2 | H3 | DK DQ D9 D3 | CA CQ C9 C5)
	East: PlayerHand(SQ SJ S6 | HA HJ H8 H7 H6 H2 | D6 D2 | C7 C3)
	West: PlayerHand(S9 S8 | HK HT H5 | DJ D7 D5 | CK CJ CT C8 C4)
), board_records=[BoardRecord(bidding_record=['PASS', '1H', '2NT', 'PASS', '3NT', 'PASS', 'PASS', 'PASS'], raw_bidding_record=['p', '1H', '2N', 'p', '3N', 'p', 'p', 'p'], play_record=[H4, H2, HJ, HA, DA, D4, D3, S3, DJ, D8, D6, S4, DT, D9, D7, S6, D2, C3, DK, SJ, DQ, C4, D5, S7, S2, H3, SK, SA, HT, HQ, HK, C2, H5, S5, H9, H8, C5, CT, CA, C6, H7, C7, ST, S8, H6, C9, C8, S9, CQ, CJ, CK, SQ], declarer=NORTH, contract=Contract(level=3, suit=NO_TRUMP, doubled=0), tricks=6, scoring=None, names={NORTH: 'smalark', SOUTH: 'PrinceBen', EAST: 'granola357', WEST: 'Forrest_'}, date='2020-03-13', event='QuickTricks Club Game', bidding_metadata=[BidMetadata(bid_index=2, bid='2NT', alerted=False, explanation='Unusual No Trump: 2 5card minors')], commentary=None, score=-300)])
</span></pre></table></code></div></div><p>All of these classes are implemented as frozen <a href="https://docs.python.org/3/library/dataclasses.html">Python Dataclasses</a> and should be treated as immuatable.</p><h3 id="portable-bridge-notation">Portable Bridge Notation</h3><p>Portable Bridge Notation (PBN) is one of the most common bridge data formats. It contains all the information we discussed above that is needed for record-keeping, as well as some additional fields which Bridgebots does not yet support. It is designed to be human-readable, which is great for players, but this design decision means PBN is somewhat difficult for a bridge program to use. If you want to know all the details, you can read the full <a href="https://www.tistis.nl/pbn/">PBN standard</a>. Here’s an example:</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre>[Event "Cavendish Pairs Day 2"]
[Site "Rio Hotel, Las Vegas, USA"]
[Date "2004.05.05"]
[Board "10"]
[West ""]
[North ""]
[East ""]
[South ""]
[Dealer "E"]
[Vulnerable "All"]
[Deal "W:63.K3.K9532.J963 T82.62.T764.KQ42 KQJ7.QJ754.AJ.AT A954.AT98.Q8.875"]
[Scoring "IMP;Cross"]
[Declarer "W"]
[Contract "3NT"]
[Result "9"]
[Auction "E"]
1H Pass 1S =1= Pass
2C ! Pass 2H =2= Pass
2S =3= Pass 3NT AP
[Note "1:0-4 !ss"]
[Note "2:less than 8 points"]
[Note "3:17+ with 4 !S"]
[Play "N"]
CQ CA C8 C3
H6 H4 HT HK
H2 HQ HA H3
CK CT C5 C6
D4 DJ DQ DK
C2 S7 C7 CJ
C4 H5 S4 C9
-  -  -  S6
*
[Stage "Round 4"]
[HomeTeam "Team 1"]
[VisitTeam "Team 2"]
[ScoreIMP "NS -241"]


</pre></table></code></div></div><p>Most of these fields are straightforward, but a few require some effort to consume programmatically. The <code class="language-plaintext highlighter-rouge">Auction</code> section places four bids on each text line, but alerts and explanations are interspersed. To understand what a <code class="language-plaintext highlighter-rouge">Note</code> node is referring to, the user needs to match the note number to the bid proceeding the explanation number from the auction.</p><p>The <code class="language-plaintext highlighter-rouge">Play</code> section keeps each player’s play in the same text column. This is great for scanning the play as a human, but a program needs to be able to understand which player won the previous trick in order to determine the order the cards must have been played in the current trick.</p><h3 id="python-bridge-nuptials">Python Bridge Nuptials</h3><p>PBNs was the data format I most wanted access to for my bridge data projects, so the original use case for Bridgebots was parsing PBNs. The <code class="language-plaintext highlighter-rouge">pbn</code> module provides this.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">bridgebots</span> <span class="kn">import</span> <span class="n">DealRecord</span><span class="p">,</span> <span class="n">parse_pbn</span>

<span class="n">pbn_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s">"path/to/above/example.pbn"</span><span class="p">)</span>
<span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DealRecord</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_pbn</span><span class="p">(</span><span class="n">pbn_path</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="go">[DealRecord(deal=Deal(
	dealer=Direction.EAST, ns_vulnerable=True, ew_vulnerable=True
	North: PlayerHand(ST S8 S2 | H6 H2 | DT D7 D6 D4 | CK CQ C4 C2)
	South: PlayerHand(SA S9 S5 S4 | HA HT H9 H8 | DQ D8 | C8 C7 C5)
	East: PlayerHand(SK SQ SJ S7 | HQ HJ H7 H5 H4 | DA DJ | CA CT)
	West: PlayerHand(S6 S3 | HK H3 | DK D9 D5 D3 D2 | CJ C9 C6 C3)
</span><span class="gp">), board_records=[BoardRecord(bidding_record=['1H', 'PASS', '1S', 'PASS', '2C', 'PASS', '2H', 'PASS', '2S', 'PASS', '3NT', 'PASS', 'PASS', 'PASS'], raw_bidding_record=['1H', 'Pass', '1S', '=1=', 'Pass', '2C', '!', 'Pass', '2H', '=2=', 'Pass', '2S', '=3=', 'Pass', '3NT', 'AP'], play_record=[CQ, CA, C8, C3, H4, HT, HK, H6, H3, H2, HQ, HA, C5, C6, CK, CT, D4, DJ, DQ, DK, CJ, C2, S7, C7, C9, C4, H5, S4, S6], declarer=WEST, contract=Contract(level=3, suit=NO_TRUMP, doubled=0), tricks=9, scoring='IMP;</span>Cross<span class="s1">', names={NORTH: '', SOUTH: '', EAST: '', WEST: ''}, date='</span>2004.05.05<span class="s1">', event='</span>Cavendish Pairs Day 2<span class="s1">', bidding_metadata=[BidMetadata(bid_index=2, bid='</span>1S<span class="s1">', alerted=False, explanation='</span>0-4 <span class="o">!</span>ss<span class="s1">'), BidMetadata(bid_index=4, bid='</span>2C<span class="s1">', alerted=True, explanation=None), BidMetadata(bid_index=6, bid='</span>2H<span class="s1">', alerted=False, explanation='</span>less than 8 points<span class="s1">'), BidMetadata(bid_index=8, bid='</span>2S<span class="s1">', alerted=False, explanation='</span>17+ with 4 <span class="o">!</span>S<span class="s1">')], commentary=None, score=600)])]
</span></pre></table></code></div></div><h3 id="bridgebots-activate">Bridgebots Activate!</h3><p>Last week I promised that I would show you Bridgebots in action with real bridge data. There is an amazing repository of PBN records at <a href="http://bridgetoernooi.com">Bridge Toernooi</a> (Dutch for Tournament) covering many years of the Bermuda Bowl, Cavendish, Spingold, Vanderbilt and National matches. Let’s start with the 2017 Bermuda Bowl which can be <a href="http://bridgetoernooi.com/index.php/home/download">downloaded</a> as a single zipped PBN file.</p><p>First we load and process the pbn file.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">bridgebots</span> <span class="kn">import</span> <span class="n">DealRecord</span><span class="p">,</span> <span class="n">parse_pbn</span>

<span class="n">pbn_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s">"/path/to/bermuda_bowl_2017.pbn"</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">parse_pbn</span><span class="p">(</span><span class="n">pbn_path</span><span class="p">)</span>
</pre></table></code></div></div><p>Now we can use Bridgebots to write simple programs to find data we’re interested in. In 2017 USA2 consisting of Martin Fleisher, Joe Grue, Chip Martel, Brad Moss, Jacek Pszczoła, Michael Rosenberg, and Jan Martel (npc) won the main event. Michael Rosenberg is famous for his declarer play, so let’s collect all the boards where he declared.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">rosenberg_deals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">deal_record</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">board_record</span> <span class="ow">in</span> <span class="n">deal_record</span><span class="p">.</span><span class="n">board_records</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">board_record</span><span class="p">.</span><span class="n">names</span><span class="p">[</span><span class="n">board_record</span><span class="p">.</span><span class="n">declarer</span><span class="p">]</span> <span class="o">==</span> <span class="s">"Mic Rosenb"</span><span class="p">:</span>
            <span class="n">rosenberg_deals</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">DealRecord</span><span class="p">(</span><span class="n">deal_record</span><span class="p">.</span><span class="n">deal</span><span class="p">,</span> <span class="p">[</span><span class="n">board_record</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rosenberg_deals</span><span class="p">))</span>
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">47
</span></pre></table></code></div></div><p>Now let’s see how often he made his contract.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">deal_record</span><span class="p">.</span><span class="n">board_records</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">score</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">deal_record</span> <span class="ow">in</span> <span class="n">rosenberg_deals</span><span class="p">))</span>
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">31
</span></pre></table></code></div></div><p>Not bad!</p><p>Say I’m interested in going over every slam in the tournament.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">slam_deal_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">deal_record</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">board_record</span> <span class="ow">in</span> <span class="n">deal_record</span><span class="p">.</span><span class="n">board_records</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">board_record</span><span class="p">.</span><span class="n">contract</span><span class="p">.</span><span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">slam_deal_dict</span><span class="p">[</span><span class="n">deal_record</span><span class="p">.</span><span class="n">deal</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">board_record</span><span class="p">)</span>
<span class="n">slam_deal_records</span> <span class="o">=</span> <span class="p">[</span><span class="n">DealRecord</span><span class="p">(</span><span class="n">deal</span><span class="p">,</span> <span class="n">board_records</span><span class="p">)</span> <span class="k">for</span> <span class="n">deal</span><span class="p">,</span> <span class="n">board_records</span> <span class="ow">in</span> <span class="n">slam_deal_dict</span><span class="p">.</span><span class="n">items</span><span class="p">()]</span>
<span class="k">print</span><span class="p">(</span><span class="s">"deals with slams:"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">slam_deal_records</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"boards with slams:"</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dr</span><span class="p">.</span><span class="n">board_records</span><span class="p">)</span> <span class="k">for</span> <span class="n">dr</span> <span class="ow">in</span> <span class="n">slam_deal_records</span><span class="p">))</span>
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">deals with slams: 42
boards with slams: 113
</span></pre></table></code></div></div><p><a href="https://youtu.be/mMqMCMcwO8o?t=15">Slammin!</a></p><p>That’s all for today. Stay tuned for Part III where we will dive into the wonders of more bridge data formats: LIN (used by BBO) and JSON.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/bridge/'>bridge</a>, <a href='/categories/bridgebots/'>bridgebots</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Introducing Bridgebots Part 2: Deal Records and PBNs - Forrest Rice&url=https://forrestrice.com/posts/Introducing-Bridgebots-Part-2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Introducing Bridgebots Part 2: Deal Records and PBNs - Forrest Rice&u=https://forrestrice.com/posts/Introducing-Bridgebots-Part-2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Bridgebots-ML-Introduction/">Bridgebots ML: Introduction</a><li><a href="/posts/Introducing-Bridgebots-Part-2/">Introducing Bridgebots Part 2: Deal Records and PBNs</a><li><a href="/posts/Introducing-Bridgebots-Part-3/">Introducing Bridgebots Part 3: LIN files and JSON</a><li><a href="/posts/QT-8-Post-Mortem/">QT 8 Post-Mortem</a><li><a href="/posts/QT-Post-Mortem/">QT Post-Mortem</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Introducting-Bridgebots-Part-1/"><div class="card-body"> <span class="timeago small" > Sep 11, 2021 <i class="unloaded">2021-09-11T12:45:09-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Introducing Bridgebots Part 1: Suits, Cards, Hands, and Deals</h3><div class="text-muted small"><p> Over the past year I have been pursuing a few different bridge programming projects. Eventually I would like to explore the possibility of building ML models which can play and bid competitively, u...</p></div></div></a></div><div class="card"> <a href="/posts/Introducing-Bridgebots-Part-3/"><div class="card-body"> <span class="timeago small" > Nov 27, 2021 <i class="unloaded">2021-11-27T11:45:09-08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Introducing Bridgebots Part 3: LIN files and JSON</h3><div class="text-muted small"><p> In my last post I covered how Bridgebots records the auction and the play of the hand, and how it can be used to import and analyze results from PBN files. Today we will expand that functionality t...</p></div></div></a></div><div class="card"> <a href="/posts/Bridgebots-Tools/"><div class="card-body"> <span class="timeago small" > Jan 30 <i class="unloaded">2022-01-30T10:05:09-08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bridgebots Tools: CSV Report</h3><div class="text-muted small"><p> I enjoy participating in the bridge-dev mailing list. There are a lot of cool ideas and discussions happening about building software for bridge. Recently, another group member reached out with que...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Introducting-Bridgebots-Part-1/" class="btn btn-outline-primary" prompt="Older"><p>Introducing Bridgebots Part 1: Suits, Cards, Hands, and Deals</p></a> <a href="/posts/Introducing-Bridgebots-Part-3/" class="btn btn-outline-primary" prompt="Newer"><p>Introducing Bridgebots Part 3: LIN files and JSON</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/Forrest_Rice">Forrest Rice</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://forrestrice.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
