<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Bridgebots ML: Introduction" /><meta property="og:locale" content="en_US" /><meta name="description" content="I have been interested in applying Machine Learning to Bridge data for a long time; it was one of the original impetuses for building Bridgebots. Over the past few months I have made slow progress towards that goal. Today I would like to make a three-part introduction to that work. The first section will focus on Machine Learning, the second on Bridge, and the third on applying ML to Bridge." /><meta property="og:description" content="I have been interested in applying Machine Learning to Bridge data for a long time; it was one of the original impetuses for building Bridgebots. Over the past few months I have made slow progress towards that goal. Today I would like to make a three-part introduction to that work. The first section will focus on Machine Learning, the second on Bridge, and the third on applying ML to Bridge." /><link rel="canonical" href="https://forrestrice.com/posts/Bridgebots-ML-Introduction/" /><meta property="og:url" content="https://forrestrice.com/posts/Bridgebots-ML-Introduction/" /><meta property="og:site_name" content="Forrest Rice" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-18T23:00:09-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Bridgebots ML: Introduction" /><meta name="twitter:site" content="@Forrest_Rice" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"I have been interested in applying Machine Learning to Bridge data for a long time; it was one of the original impetuses for building Bridgebots. Over the past few months I have made slow progress towards that goal. Today I would like to make a three-part introduction to that work. The first section will focus on Machine Learning, the second on Bridge, and the third on applying ML to Bridge.","url":"https://forrestrice.com/posts/Bridgebots-ML-Introduction/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://forrestrice.com/posts/Bridgebots-ML-Introduction/"},"headline":"Bridgebots ML: Introduction","dateModified":"2022-06-19T00:14:25-07:00","datePublished":"2022-06-18T23:00:09-07:00","@context":"https://schema.org"}</script><title>Bridgebots ML: Introduction | Forrest Rice</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Forrest Rice"><meta name="application-name" content="Forrest Rice"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/headshot.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Forrest Rice</a></div><div class="site-subtitle font-italic">Life and other games</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/forrestrice" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/Forrest_Rice" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['forrest.d.rice','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Bridgebots ML: Introduction</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Bridgebots ML: Introduction</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Forrest Rice </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Jun 18, 2022, 11:00 PM -0700" prep="on" > Jun 18 <i class="unloaded">2022-06-18T23:00:09-07:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Jun 19, 2022, 12:14 AM -0700" prefix="Updated " > Jun 19 <i class="unloaded">2022-06-19T00:14:25-07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2798 words">15 min</span></div></div><div class="post-content"><p>I have been interested in applying Machine Learning to Bridge data for a long time; it was one of the original impetuses for building Bridgebots. Over the past few months I have made slow progress towards that goal. Today I would like to make a three-part introduction to that work. The first section will focus on Machine Learning, the second on Bridge, and the third on applying ML to Bridge.</p><h2 id="machine-learning">Machine Learning</h2><p>Machine Learning is a huge field that encompasses many different concepts and techniques. At its core, it is the application of statistics to find patterns in data. Most ML can be categorized as one of the following:</p><ol><li>Supervised Learning<li>Unsupervised Learning<li>Reinforcement Learning</ol><h4 id="supervised-learning">Supervised Learning</h4><p><a href="https://en.wikipedia.org/wiki/Supervised_learning">Supervised Learning</a> describes tasks for which we have labeled data, and the process of training models to predict those labels. In Bridge data, we might give the model the auction and ask it to predict the number of High Card Points (HCP) held by each player. From historical matches, we have lots of examples we can give the model to learn this relationship. When the model makes an incorrect prediction, we use the label from the training data to instruct the model to update itself to be more accurate in the future. This is accomplished through techniques like <a href="https://en.wikipedia.org/wiki/Backpropagation">Backpropagation</a> and <a href="https://en.wikipedia.org/wiki/Stochastic_gradient_descent">Stochastic Gradient Descent</a>.</p><h4 id="unsupervised-learning">Unsupervised Learning</h4><p><a href="https://en.wikipedia.org/wiki/Unsupervised_learning">Unsupervised Learning</a> describes finding patterns in unlabeled data. The most common applications are clustering analysis and anomaly detection. For Bridge, we could cluster bidding systems or partnerships together based on auctions or cardplay. Anomaly detection could be used to find highly unusual bids or plays which could be indicative of cheating. Popular techniques include <a href="https://en.wikipedia.org/wiki/K-means_clustering">k-means Clustering</a> and <a href="https://en.wikipedia.org/wiki/Principal_component_analysis">Principal Component Analysis</a>.</p><h4 id="reinforcement-learning">Reinforcement Learning</h4><p><a href="https://en.wikipedia.org/wiki/Reinforcement_learning">Reinforcement Learning</a> describes the process of teaching an agent how to interact with its environment to maximize reward. It is not supervised learning because the agent is not taught exactly what to do, and it is not unsupervised because the agent is influenced by an outside goal. For Bridge, Reinforcement Learning could be used to teach an agent to bid or play, similar to the techniques that were used to train <a href="https://en.wikipedia.org/wiki/AlphaGo_Zero">AlphaGo Zero</a> and <a href="https://en.wikipedia.org/wiki/AlphaZero">AlphaZero</a> to play Go and Chess at superhuman levels.</p><h3 id="training-a-supervised-learning-model">Training a Supervised Learning Model</h3><p>For my first ML project with Bridgebots I wanted to focus on supervised learning. It is much easier to understand what a model is doing and how it is performing when you have labeled data to check against. The general process for approaching a supervised learning problem looks like this:</p><ol><li>Collect historical data. More data is better, but having clean (error-free) data is generally even more important.<li>Generate labels that you would like the model to be able to predict, either programmatically or by hand.<li>Split the data into training, validation, and test sets. There are several ways to approach this, but in general the training set is used to teach the model, the validation set is used to verify that the model has learned the general principles of the problem well (not just memorized the training data), and the test set is used as the final measure of the performance of the model.<li>Develop features that will be used as inputs to the model. For bridge this might be a representation of the bids that were made, the cards in a player’s hand, the vulnerability, or the players involved.<li>Train a model to predict the target labels and evaluate its performance.<li>Iterate over model architectures and model training parameters to improve model performance.<li>Release a final version of the model which can be used for future predictions.</ol><h2 id="bridge">Bridge</h2><p>Bridge is a complicated game, and I am assuming most readers of this blog are familiar with the basics. If you are familiar, then feel free to skip this section. If you are not, check out <a href="https://www.acbl.org/learn/">this introduction page</a> from the ACBL or <a href="https://www.youtube.com/watch?v=2IomnCvxWzM">this tutorial on youtube</a> and/or read the below description. Each bridge hand is composed of three sections:</p><h3 id="the-deal">The Deal</h3><p>Two partnerships sit in alternating order (each player across from their partner). Thirteen cards are delt to each player. One player is chosen to start the auction, and each team is assigned a vulnerability. A vulnerable team receives more rewards for making their contracts, but also receives a higher penalty for failing.</p><h3 id="the-auction">The Auction</h3><p>Players compete for the right to name the trump suit for the play of the hand (the trump suit will be stronger than any other suit). At their turn, each player may either pass or raise the stakes of the hand (the number of tricks that must be taken to receive the reward). In general, higher contracts pay better rewards, so players try to bid as high as they safely can. The auction continues until one player makes a bid and the other three all pass. While the premise of the auction is fairly straightforward, in practice it can be incredibly complicated. This is because each partnership assigns special meanings to various sequences of bids, creating a language that is used to communicate information about their hands.</p><h3 id="the-play">The Play</h3><p>The team that won the auction will have one of their players (the declarer) make all the decisions for the rest of the hand. The declarer’s teammate’s hand (the dummy) will be revealed to everyone. This means the declarer has access to perfect information about all their team’s assets, while the defenders have imperfect information, but all of their assets are hidden from declarer. In sequence, each player will play a single card to a trick. Each player must follow the suit of the first card led to the trick. The highest card of that suit will win the trick unless a trump card is played, in which case the highest trump will win. The winner of a trick starts the next trick. If the declarer makes the number of tricks they contracted for in the auction, their team receives a positive score. If they fail, the defenders get the plus score.</p><h2 id="bridge-ml">Bridge ML</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/bridge/bridgebots/bridge_nn_with_shared_connections_small.png" alt="bridge ML logo" /></p><h3 id="gathering-data">Gathering Data</h3><p>Following the roadmap that I laid out above, the first step to training a supervised learning model is to collect data. There are a few different sites that host bridge data, but for this project I decided to use records from <a href="https://www.sarantakos.com/bridge/vugraph.html">The Vugraph Project</a>. It has records from dozens of high level tournaments across many years of bridge. My hope is that if our models can understand this data, then they will be able to handle a wide variety of bridge situations. The data can be downloaded fairly simply with <a href="https://www.gnu.org/software/wget/manual/html_node/index.html">wget</a> using the <a href="https://www.gnu.org/software/wget/manual/html_node/Recursive-Retrieval-Options.html">recursive flag</a>. The data is in LIN file format; luckily the <a href="https://github.com/forrestrice/bridge-bots/tree/master/bridgebots">Bridgebots core library</a> can already <a href="/posts/Introducing-Bridgebots-Part-3">handle that</a>. I created two datasets - one which can contain the same deal multiple times, and one which has a unique bidding/play record for each deal.</p><p>I have not yet merged the code used in this blog post into the main Bridgebots repository, but you can find it on this <a href="https://github.com/forrestrice/bridge-bots/tree/vugraph-project-sequence-learning">branch</a> or see the diff in this <a href="https://github.com/forrestrice/bridge-bots/pull/14">pull request</a>.</p><h3 id="labeling">Labeling</h3><p>Now that we have downloaded a few thousand deals, we need to decide which targets we want our model to predict. For my first project, I decided to focus on the auction. At each player’s turn to act, I want to predict three things:</p><ol><li>The next bid.<li>The number of high card points held by each player.<li>The shape of each player’s hand.</ol><p>I chose these targets because they are important components of playing bridge, and because it is straightforward to programmatically calculate all three of them (unlike e.g. evaluating the wisdom of a given bid). I will discuss the code used to produce these labels in a future post.</p><h3 id="trainvalidationtest-split">Train/Validation/Test Split</h3><p>For now, I am using a simple and standard split of 80% training, 10% validation, and 10% test.</p><h3 id="model-features">Model Features</h3><p>This is another subject where I will go into more detail in the future, but the basic features I included in the model were:</p><ol><li>The auction so far.<li>The vulnerability.<li>The position of the current player to act (dealer, dealer + 1, etc).<li>The cards held by the current player encoded as 52 bit flags.</ol><p>Features I wrote but have not yet included because I am not sure of their validity in the data yet:</p><ol><li>Which bids were alerted.<li>Which bids were explained.</ol><p>I have also given some thought about how to represent a partnership’s bidding system to the model. My eventual hope is to use <a href="https://en.wikipedia.org/wiki/Embedding">embeddings</a> to allow the model to take specific information about players or systems into account. Alternatively, we could devise a way to pass structured information with the bid (e.g. 3+ clubs, 10+ HCP for an opening of 1C for a partnership playing standard, 16+ HCP for a partnership playing precision). For now, all these models have no knowledge of the players or systems, so they treat every auction the same.</p><h3 id="model-training-and-iteration">Model Training and Iteration</h3><p>I am still in the process of training these models. There are many different techniques and architectures that can be used. The auction is a sequence of actions, so we can use models that specialize in handling sequential data like <a href="https://en.wikipedia.org/wiki/Long_short-term_memory">LSTMs</a> and <a href="https://en.wikipedia.org/wiki/Transformer_(machine_learning_model)">Transformers</a> to make predictions based on the history so far.</p><p>For the task of predicting the next bid, we can use classification metrics to measure the performance of our model. These include <a href="https://en.wikipedia.org/wiki/Cross_entropy">categorical crossentropy</a>, <a href="https://en.wikipedia.org/wiki/Precision_and_recall">precision</a>, and <a href="https://en.wikipedia.org/wiki/Precision_and_recall">recall</a> but there are <a href="https://en.wikipedia.org/wiki/Evaluation_of_binary_classifiers">many more</a>.</p><p>For the task of predicting the players’ shapes or HCP, we can use a regression based model. This will predict some average value (e.g. median or mean depending on the loss function used during training), but we could also augment the model to predict other aspects of the target distribution (e.g. standard deviation could tell us how wide of a range of HCP is expected for a bid).</p><p>For this work I used <a href="https://www.tensorflow.org/">Tensorflow</a>, a popular Machine Learning library developed by Google.</p><h3 id="releasing-a-model">Releasing a Model</h3><p>I spent some time building a saving/loading mechanism that will bundle the features needed by the model with the model internals (weights + structure). A user can download these models and run them locally using the Bridgebots Python library. These models are far from perfect, but as you will see below, they already have some promise. Even when they are not provided with any system/partnership information, they make fairly reasonable predictions about the auction and holdings of the players. Like the rest of Bridgebots, the models and the code used to train them are being released under the <a href="https://en.wikipedia.org/wiki/MIT_License">MIT Open Source License</a>, which means they will be freely available for anyone to use or modify.</p><h2 id="examples">Examples</h2><p>I have published the first generation of these models to a <a href="https://console.cloud.google.com/storage/browser/bridgebots-public;tab=objects?prefix=&amp;forceOnObjectsSortingFiltering=false">public GCP storage bucket</a>, and I built an example <a href="https://colab.research.google.com/drive/1DoW2cVw8IBS5DoOgajcVd-jD4p785pIP?usp=sharing">Google Colab notebook</a> which shows how they can be loaded and run.</p><h3 id="loading-the-model">Loading the Model</h3><p>The models can be loaded by installing the bridgebots-sequence package.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>pip <span class="nb">install </span>bridgebots-sequence
</pre></table></code></div></div><p>Then an “Inference Engine” can be created from the saved model data:</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">bridgebots_sequence.inference</span> <span class="kn">import</span> <span class="n">BiddingInferenceEngine</span>


<span class="n">hcp_engine</span> <span class="o">=</span> <span class="n">BiddingInferenceEngine</span><span class="p">(</span>
    <span class="n">model_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s">"./bridgebots-public/bid_learn/gen_1/hcp/"</span><span class="p">),</span>
<span class="p">)</span>
</pre></table></code></div></div><h3 id="running-the-model">Running the Model</h3><p>Each model needs inputs in order to make predictions. This information should be provided in the form of Bridgebots representations of cardinal directions, cards, and bids. For example:</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">bridgebots</span> <span class="kn">import</span> <span class="n">Card</span><span class="p">,</span> <span class="n">Direction</span>

<span class="n">dealer</span> <span class="o">=</span> <span class="n">Direction</span><span class="p">.</span><span class="n">SOUTH</span>
<span class="n">dealer_vulnerable</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">dealer_opp_vulnerable</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">player_holding</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Card</span><span class="p">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"S7"</span><span class="p">,</span> <span class="s">"S2"</span><span class="p">,</span> <span class="s">"HA"</span><span class="p">,</span> <span class="s">"HJ"</span><span class="p">,</span> <span class="s">"H9"</span><span class="p">,</span> <span class="s">"H2"</span><span class="p">,</span> <span class="s">"DK"</span><span class="p">,</span> <span class="s">"DJ"</span><span class="p">,</span> <span class="s">"D2"</span><span class="p">,</span> <span class="s">"CA"</span><span class="p">,</span> <span class="s">"CQ"</span><span class="p">,</span> <span class="s">"CJ"</span><span class="p">,</span> <span class="s">"C4"</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">bidding_record</span> <span class="o">=</span> <span class="p">[</span><span class="s">"1S"</span><span class="p">,</span> <span class="s">"PASS"</span><span class="p">,</span> <span class="s">"2C"</span><span class="p">,</span> <span class="s">"PASS"</span><span class="p">,</span> <span class="s">"2H"</span><span class="p">,</span> <span class="s">"PASS"</span><span class="p">,</span> <span class="s">"3H"</span><span class="p">,</span> <span class="s">"PASS"</span><span class="p">,</span> <span class="s">"3S"</span><span class="p">,</span> <span class="s">"PASS"</span><span class="p">,</span> <span class="s">"4D"</span><span class="p">,</span> <span class="s">"X"</span><span class="p">,</span> <span class="s">"PASS"</span><span class="p">,</span> <span class="s">"PASS"</span><span class="p">]</span>
<span class="n">bidding_metadata</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">print</span><span class="p">(</span>
    <span class="s">"Predicted hcp:</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
    <span class="n">hcp_engine</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span>
        <span class="n">dealer</span><span class="p">,</span> <span class="n">dealer_vulnerable</span><span class="p">,</span> <span class="n">dealer_opp_vulnerable</span><span class="p">,</span> <span class="n">player_holding</span><span class="p">,</span> <span class="n">bidding_record</span><span class="p">,</span> <span class="n">bidding_metadata</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></table></code></div></div><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Predicted hcp:
 {SOUTH: 12.845368, WEST: 4.947876, NORTH: 15.906226, EAST: 6.1790986}
</pre></table></code></div></div><h3 id="evaluating-the-models">Evaluating the Models</h3><p>At the risk of repeating myself, the technical details of the model evaluation is something I will write up in more detail later. However, I will provide some examples of the model predictions below, and I have set up a <a href="https://colab.research.google.com/drive/1DoW2cVw8IBS5DoOgajcVd-jD4p785pIP?usp=sharing">Google Colab notebook</a> so that anybody can try the models for themselves. For these examples, I chose to look at <a href="https://www.bridgebase.com/tools/handviewer.html?bbo=y&amp;linurl=https://www.bridgebase.com/tools/vugraph_linfetch.php?id=74272">this segment</a> of the <a href="http://www.worldbridge.org/competitions/wbf-championships/world-bridge-teams-championships/dorsi-seniors-trophy/">2022 d’Orsi</a> between the USA and India. For each of these hands, we will “replace” one of the players with the models and see how they would evaluate the auction. That means that only 13 of the 52 cards are provided as input.</p><h4 id="board-24">Board 24</h4><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/bridge/bridgebots/dot_24.png" alt="board 24" /> The model evaluates the board from the perspective of Meckstroth after the auction reaches 2SX:</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>NORTH - HCP:12.056150436401367, Shape:[1.8675611 3.1290896 3.823617  4.12866  ]
EAST - HCP:7.969760894775391, Shape:[3.3415089 3.3108985 3.2528265 3.0557857]
SOUTH - HCP:12.726337432861328, Shape:[2.9363637 3.3428063 3.112618  3.529826 ]
WEST - HCP:7.195767402648926, Shape:[4.8077374 3.1735537 2.7231622 2.2366753]
Predicted bid: 3C
Predicted bid probabilities:[('3C', 0.27392504), ('2NT', 0.2338383), ('3D', 0.18260154), ('PASS', 0.10459597), ('3H', 0.06501402)]
</pre></table></code></div></div><p>The model did well understanding that West held spades after they opened a multi 2D, and that North would bid 3C (27%) or 2NT (23%), both of which were suggested by the commentators. The model struggled with the fact that East’s 2S actually showed a preference for hearts, and overestimated South’s strength.</p><h3 id="board-31">Board 31</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/bridge/bridgebots/dot_31.png" alt="board 31" /> Let’s look at what the model thought was going on at each of Meckstroth’s calls.</p><p>After <code class="language-plaintext highlighter-rouge">["1S", "PASS"]</code>:</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>NORTH - HCP:15.839217185974121, Shape:[2.021296  3.9838076 3.0657048 4.007261 ]
EAST - HCP:5.896975994110107, Shape:[2.8044546 3.5252647 3.7001972 3.08169  ]
SOUTH - HCP:12.090693473815918, Shape:[5.4067245 2.3355904 2.9286385 2.4316034]
WEST - HCP:6.003118991851807, Shape:[2.8464196 3.2721624 3.4069438 3.5730052]
Predicted bid: 2C
Predicted bid probabilities:[('2C', 0.4598667), ('2NT', 0.2520364), ('2H', 0.12931933), ('2D', 0.07926174)]
</pre></table></code></div></div><p>After <code class="language-plaintext highlighter-rouge">["1S", "PASS", "2C", "PASS", "2H", "PASS"]</code>:</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>NORTH - HCP:16.015335083007812, Shape:[2.015837  3.9580772 3.071818  4.0097213]
EAST - HCP:5.516820907592773, Shape:[3.0574307 3.0101004 3.9873986 3.0293846]
SOUTH - HCP:12.106705665588379, Shape:[4.9549217 3.3470654 2.5047426 2.2745743]
WEST - HCP:6.300617694854736, Shape:[3.0348947 2.7714062 3.5119736 3.7505522]
Predicted bid: 2NT
Predicted bid probabilities:[('2NT', 0.40432608), ('3H', 0.20415133), ('4H', 0.09077729), ('3C', 0.05689908), ('2S', 0.053402733)]
</pre></table></code></div></div><p>After <code class="language-plaintext highlighter-rouge">["1S", "PASS", "2C", "PASS", "2H", "PASS", "3H", "PASS", "3S", "PASS"]</code>:</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>NORTH - HCP:16.078683853149414, Shape:[1.9772431 4.0498543 2.9730036 4.0501876]
EAST - HCP:5.4062113761901855, Shape:[3.059058  2.6944509 4.2516003 3.0805616]
SOUTH - HCP:12.723127365112305, Shape:[4.9007063 3.614962  2.5420392 2.0281525]
WEST - HCP:5.835963726043701, Shape:[3.1310077 2.736113  3.3029883 3.9128149]
Predicted bid: 4C
Predicted bid probabilities:[('4C', 0.50220186), ('3NT', 0.23680453), ('4NT', 0.08573343), ('4D', 0.06225779), ('4H', 0.06137136)]
</pre></table></code></div></div><p>After <code class="language-plaintext highlighter-rouge">["1S", "PASS", "2C", "PASS", "2H", "PASS", "3H", "PASS", "3S", "PASS", "4D", "X", "PASS", "PASS"]</code></p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>NORTH - HCP:15.906225204467773, Shape:[1.9650984 4.0142136 2.962     4.0986676]
EAST - HCP:6.1790995597839355, Shape:[2.93841   2.4142017 4.4957485 3.230924 ]
SOUTH - HCP:12.84537124633789, Shape:[5.094196  3.867588  2.5129228 1.612994 ]
WEST - HCP:4.947877407073975, Shape:[3.0642023 2.8014474 3.0946152 4.124716 ]
Predicted bid: XX
Predicted bid probabilities:[('XX', 0.9760938)]
</pre></table></code></div></div><p>The model quickly recognized an opening spade bid in terms of shape and strength, and predicted the 2/1 auction. It adjusted its belief about South’s shape after the 2H rebid, but probably not as much as we would want, since this almost always shows 4+. It also missed that North would raise hearts (this could be related to the incorrect prediction about shape), and overemphasized the likelihood of redoubling at Meckstroth’s last call. Overall we can see the model could still be improved a lot, but its predictions are at least in the right neighborhood for many aspects of the hand.</p><h4 id="board-18">Board 18</h4><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/bridge/bridgebots/dot_18.png" alt="board 18" /> Lets do the same step by step evaluation for Saha on Board 18.</p><p>After <code class="language-plaintext highlighter-rouge">["PASS", "1C"]</code></p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>NORTH - HCP:8.551470756530762, Shape:[3.9040601 3.1166744 3.1397586 2.8878965]
EAST - HCP:6.108532428741455, Shape:[3.74385   2.9586966 3.2413125 3.0909529]
SOUTH - HCP:14.163474082946777, Shape:[3.381772  3.0403666 2.552261  4.079942 ]
WEST - HCP:10.894444465637207, Shape:[2.0130272 3.9442337 4.1041923 2.9768863]
Predicted bid: PASS
Predicted bid probabilities:[('PASS', 0.42284918), ('1H', 0.30451122), ('1D', 0.15629105), ('X', 0.06527666)]
</pre></table></code></div></div><p>After <code class="language-plaintext highlighter-rouge">['PASS', '1C', 'PASS', '3C', 'X', 'PASS']</code></p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>NORTH - HCP:7.928995132446289, Shape:[2.6428466 2.4678926 3.2113147 4.795836 ]
EAST - HCP:7.6490960121154785, Shape:[4.353987  3.5895529 3.3248572 1.8434293]
SOUTH - HCP:13.27055835723877, Shape:[4.0041056 3.0925465 2.5056815 3.5044522]
WEST - HCP:10.901622772216797, Shape:[2.0748663 3.9804525 4.0774617 2.9409585]
Predicted bid: 3H
Predicted bid probabilities:[('3H', 0.46870205), ('4H', 0.3312904), ('3D', 0.06510229)]
</pre></table></code></div></div><p>Nice job on this one! The model correctly assessed that Saha would pass and then bid 3H. It also understood that North had long clubs with less than invitational values, and that East had length in the other suits. It likely predicted that East’s spades were longer because we provided West’s hand (which has four hearts, four diamonds, and only two spades) as an input. The final HCP predictions are just about right as well!</p><h2 id="wrapping-up">Wrapping Up</h2><p>Thanks for following along! I hope you now find the possibilities of applying ML to Bridge as exciting as I do. If you are interested in how these models were trained or even in training some models of your own, stay tuned - I have a lot more to show you!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/bridge/'>bridge</a>, <a href='/categories/bridgebots/'>bridgebots</a>, <a href='/categories/machine-learning/'>machine-learning</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Bridgebots ML: Introduction - Forrest Rice&url=https://forrestrice.com/posts/Bridgebots-ML-Introduction/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Bridgebots ML: Introduction - Forrest Rice&u=https://forrestrice.com/posts/Bridgebots-ML-Introduction/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Bridgebots-ML-Introduction/">Bridgebots ML: Introduction</a><li><a href="/posts/Introducing-Bridgebots-Part-2/">Introducing Bridgebots Part 2: Deal Records and PBNs</a><li><a href="/posts/Introducing-Bridgebots-Part-3/">Introducing Bridgebots Part 3: LIN files and JSON</a><li><a href="/posts/QT-8-Post-Mortem/">QT 8 Post-Mortem</a><li><a href="/posts/QT-Post-Mortem/">QT Post-Mortem</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Introducting-Bridgebots-Part-1/"><div class="card-body"> <span class="timeago small" > Sep 11, 2021 <i class="unloaded">2021-09-11T12:45:09-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Introducing Bridgebots Part 1: Suits, Cards, Hands, and Deals</h3><div class="text-muted small"><p> Over the past year I have been pursuing a few different bridge programming projects. Eventually I would like to explore the possibility of building ML models which can play and bid competitively, u...</p></div></div></a></div><div class="card"> <a href="/posts/Introducing-Bridgebots-Part-2/"><div class="card-body"> <span class="timeago small" > Sep 18, 2021 <i class="unloaded">2021-09-18T12:45:09-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Introducing Bridgebots Part 2: Deal Records and PBNs</h3><div class="text-muted small"><p> Last week I introduced a new bridge programming library: Bridgebots. I covered how to create and interact with Cards, Suits, and Deals. Today we’ll look at how Bridgebots represents the auction, th...</p></div></div></a></div><div class="card"> <a href="/posts/Introducing-Bridgebots-Part-3/"><div class="card-body"> <span class="timeago small" > Nov 27, 2021 <i class="unloaded">2021-11-27T11:45:09-08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Introducing Bridgebots Part 3: LIN files and JSON</h3><div class="text-muted small"><p> In my last post I covered how Bridgebots records the auction and the play of the hand, and how it can be used to import and analyze results from PBN files. Today we will expand that functionality t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Bridgebots-Tools/" class="btn btn-outline-primary" prompt="Older"><p>Bridgebots Tools: CSV Report</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/Forrest_Rice">Forrest Rice</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://forrestrice.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
